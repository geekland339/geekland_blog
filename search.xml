<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>docker自动化部署</title>
      <link href="/posts/f260a62c.html"/>
      <url>/posts/f260a62c.html</url>
      
        <content type="html"><![CDATA[<div class="note blue no-icon flat"><p>文章主要记录一下如何实现项目的自动化集成部署，并且让docker容器支持<code>HTTPS</code>的访问，并且通过几个例子来实践。这也是我目前觉得服务端比较好的架构思路了</p></div><h1 id="解决哪些痛点问题"><a href="#解决哪些痛点问题" class="headerlink" title="解决哪些痛点问题"></a>解决哪些痛点问题</h1><div class="note red no-icon flat"><p>在个人开发项目的时候，我们希望自己写的项目网站能放到有公网<code>IP</code>的服务器上供每个人都可以浏览访问，但是服务器端通常会遇到一些问题：</p><p><strong>端口问题：</strong></p><p>比如A项目需要占用3000端口，B项目也需要，这个时候导致端口的冲突，就需要修改端口。而且记住端口也是一件很麻烦的事情，容易导致端口冲突问题。（本文只需要服务器开放80和443端口，通过ngixn代理其他docker容器，从而无需开启其他端口就可以访问到容器应用）</p><p><strong>部署问题：</strong></p><p>每次项目代码的小改动，都需要重新本地构建，连接服务器上传代码，这是非常麻烦的一件事情。（通过Jenkins自动化集成部署可以解决该问题）</p><p><strong><code>HTTPS</code>证书问题：</strong></p><p>每个项目需要域名访问，比如<code>api.admin.com</code>对应的是<code>api</code>接口项目，<code>front.admin.com</code>对应前端项目，但是证书需要为每个域名单独申请，这就很费时费力了，而且每个证书都有时效性的，过期就需要手动更新，很麻烦（通过<code>acme</code>可以自动更新证书，并且是免费开源的）</p><p><strong>碎片化:</strong></p><p>服务器端存放的会比较碎片化，安装的软件会比较杂，容易导致软件之间的冲突，比如服务器安装的node环境是14，其中一个项目只能在<code>node14</code>才可以正常运行，另外一个则需要在<code>node20</code>环境才可以，或者一个项目放在微信云服务上，另外一个存放在某静态存放网站，这样有可能导致跨域问题，域名也无法统一。（使用一台服务器，利用<code>Docker</code>的隔离性恰好可以解决这个问题）</p><p>以上这些痛点问题，本文会搭建一个在服务端持续集成持续部署的环境，并使用<code>Nginx</code>代理支持<code>https</code>的访问。</p></div><h1 id="服务端整体的架构与思路"><a href="#服务端整体的架构与思路" class="headerlink" title="服务端整体的架构与思路"></a>服务端整体的架构与思路</h1><div class="note blue no-icon flat"><p>在开始搭建之前，有必要先看一下服务端整体的架构图，了解一下在干什么，为什么要这么做，这么做的目的是什么：</p></div><p><img src="https://img.mstudio.top/img/202406302138165.png"></p><div class="note purple no-icon flat"><p>先来看下流程：</p><ul><li>用户通过<code>www.example.com</code>、<code>api.example.com</code>或者<code>blog.example.com</code>等二级域名访问服务</li><li><code>DNS</code>服务器（DNSpro、cloudflare）解析这个网址到指定服务器的<code>IP</code>地址上的80端口</li><li><code>Nginx</code>接收到这个请求，通过<code>conf</code>配置文件，在内网里面找到这个Docker容器服务，并访问这个Docker容器（这个过程中，<code>Nginx</code>已经通过配置文件给链接加上<code>https</code>证书加密）</li><li><code>Docker</code>容器返回给<code>Nginx</code>，<code>Nginx</code>再通过443端口返回给用户。</li></ul></div><div class="note orange no-icon flat"><p>在整个过程中，服务器只是开放80和443端口，Docker容器无需对外开放端口，Docker容器之间通过内网段通讯，互不干扰</p></div><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><div class="note purple no-icon flat"><p>在开始之前，我们需要准备一下环境：</p><ul><li>一台初始化的<code>centos7.8</code>系统服务器（避免软件安装冲突）</li><li>一个已经备案的域名（国内服务器域名需要备案）</li></ul></div><h1 id="服务器连接配置"><a href="#服务器连接配置" class="headerlink" title="服务器连接配置"></a>服务器连接配置</h1><h2 id="修改默认端口："><a href="#修改默认端口：" class="headerlink" title="修改默认端口："></a>修改默认端口：</h2><p>连接服务器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@you ip</span><br></pre></td></tr></table></figure><p>修改端口，编辑<code>sshd_config</code>文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>输入 i 编辑，把#去掉，把22改为想要的端口，最后:wq保存：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Port 10024</span><br></pre></td></tr></table></figure><p>然后需要执行这一句命令：（端口是刚才修改的端口）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semanage port -a -t ssh_port_t -p tcp 10024</span><br></pre></td></tr></table></figure><p>可能会得到一个错误，可以执行一下下面这句：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum whatprovides semanage</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y  policycoreutils-python</span><br></pre></td></tr></table></figure><p>最后再重新执行：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semanage port <span class="literal">-a</span> <span class="literal">-t</span> ssh_port_t <span class="literal">-p</span> tcp <span class="number">10024</span></span><br></pre></td></tr></table></figure><p>查看<code>SSH</code>运行的端口：（不是必须执行）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semanage port -l | grep ssh</span><br></pre></td></tr></table></figure><p>删除<code>SSH</code>端口：（不是必须执行）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semanage port -d -t ssh_port_t -p tcp 22 </span><br></pre></td></tr></table></figure><p>重启<code>SSH</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><p>重新连接服务器：（端口是刚才的端口）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 10024 root@your ip</span><br></pre></td></tr></table></figure><h2 id="密钥方式连接服务器："><a href="#密钥方式连接服务器：" class="headerlink" title="密钥方式连接服务器："></a>密钥方式连接服务器：</h2><p>在本地电脑生成SSH Key，一直回车就可以：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>在本地路径C:\Users\你的用户\.ssh下创建<code>config</code>文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host Test</span><br><span class="line">    Port #端口号</span><br><span class="line">    HostName #IP地址</span><br><span class="line">    User root</span><br><span class="line">    IdentityFile #本地id_rsa文件</span><br><span class="line">    IdentitiesOnly yes</span><br></pre></td></tr></table></figure><p>服务器<code>cd ~/.ssh/</code>目录，（一定要CD到这个目录，切勿直接在根目录直接使用下面命令，会导致这个文件不生效）编辑文件，到本地C:\Users\你的用户名\.ssh 找到公钥文件，把本地电脑的公钥文件<code>id_rsa.pub</code>复制进去，<code>:wq</code>保存：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi authorized_keys</span><br></pre></td></tr></table></figure><p>如果之前连接过服务器，格式化后再连接可能报错，可以先删除本地电脑这两个文件，这两个文件是历史连接的记录</p><p><img src="https://img.mstudio.top/img/202406302146329.png"></p><p>至此，完成服务器的端口修改和使用密钥登录的操作</p><h1 id="旧版安装docker"><a href="#旧版安装docker" class="headerlink" title="旧版安装docker"></a>旧版安装docker</h1><p>这个办法<strong>适合境外服务器操作</strong>，因为2024年6月初的时候，<code>Docker</code>的镜像无法正常<code>pull</code>了，所以按照这个办法会出现报错等问题，不推荐；（有新版的安装方式下面介绍）</p><p>该内容步骤具体可以参考：<a href="https://www.toimc.com/docker%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">https://www.toimc.com/docker%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</a> </p><ol><li><p>先删除旧的版本(如果没有可以跳过)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure></li><li><p>安装必须的依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br></pre></td></tr></table></figure><p>添加<code>stable</code>的Docker-ce的源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>安装<code>docker-ce</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li><li><p>启动服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br></pre></td></tr></table></figure></li></ol><p>docker-compose安装：</p><p>Docker-Compose工具是一个<code>批量</code>工具，用于运行与管理多个<code>docker</code>容器。官方文档：<a href="https://docs.docker.com/compose/install/">Install Docker Compose</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载docker-compose</span></span><br><span class="line"><span class="built_in">sudo</span> curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给予执行权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试命令</span></span><br><span class="line">docker-compose --version</span><br><span class="line">docker-compose version 1.23.2, build 1110ad01</span><br></pre></td></tr></table></figure><h1 id="新版安装docker"><a href="#新版安装docker" class="headerlink" title="新版安装docker"></a>新版安装docker</h1><p>由于不可抗力原因，截至目前，2024年6月27号，阿里云的服务器是无法正常拉取docker镜像的，以下是阿里云售后技术的回复：</p><blockquote><p>您好，近期因为<a href="https://hub.docker.com/">https://hub.docker.com/</a>  被污染（具体可以参考：<a href="https://boce.aliyun.com/home?spm=5176.smartservice_service_robot_chat_new.0.0.59b13f1b8XYWoe">https://boce.aliyun.com/home</a>） timeout等现象， 关于解决方案 </p><p>1、针对个人单docker环境客户 </p><p>1.1 本地先pull下来（因为域名被污染，本地可能也无法拉取，可以考虑中国香港或者是海外的服务器pull下来）</p><p>1.2 使用docker save导出为<code>tar.gz</code>文件，然后上传到自己的机器，使用<code>docker load -i XXX.tar.gz</code>解压出来使用 导出命令： <code>docker save -o nginx.tar.gz nginx:latest</code> 导入命令： <code>docker load -i nginx.tar.gz</code> </p><p>2、针对集群用户 </p><p>2.1 本地先pull下来（因为域名被污染，本地可能也无法拉取，可以考虑中国香港或者是海外的服务器pull下来） </p><p>2.2 修改tag 命令（例如）： <code>docker tag nginx:latest ceshi:latest 2.3</code> 然后上传到阿里云<code>acr</code> 容器镜像仓库里面，<code>yaml</code>地址里面修改为您阿里云仓库的<code>vpc</code>地址，用私网拉取，比走海外公网的速率高以及稳定性强一点 注意：如果您的集群或者是<code>ACR</code>是大陆的，可能会存在链路问题导致镜像推送到<code>ACR</code>失败，建议导出镜像后导入镜像到您本地的大陆机器，然后<code>push</code>到您的<code>ACR</code>里边</p></blockquote><p>所以现在安装<code>Docker</code>如果按照之前的方式会出现无法正常安装的情况，<code>Docker</code>也无法正常的<code>pull</code>镜像，这里有两种解决方法：（当然方法不止这两种）</p><ol><li>使用境外的服务器，把镜像<code>pull</code>到本地，然后再上传到服务器，优点是简单粗暴，原理简单。缺点是要下载镜像有限，只能先下载需要用到的镜像。（我采用的是这种方式）</li><li>使用<code>cloudflare</code>和这个开源项目<a href="https://github.com/cmliu/CF-Workers-docker.io/issues/8">https://github.com/cmliu/CF-Workers-docker.io/issues/8</a> ，原理就是使用<code>cloudflare</code>去代理<code>dockerhub</code>这个网站，这样就可以访问到<code>dockerhub</code>。配置起来很简单，具体可以看看这个UP主，讲解得比较简单明了：<a href="https://www.bilibili.com/video/BV1H442197oQ/">https://www.bilibili.com/video/BV1H442197oQ/</a></li></ol><p>这里是<code>centos7.8</code>的安装步骤：</p><ol><li><p>运行以下命令，下载<code>docker-ce</code>的<code>yum</code>源。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>运行以下命令，安装Docker。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install docker-ce</span><br></pre></td></tr></table></figure></li><li><p>执行以下命令，检查Docker是否安装成功。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure></li><li><p>如下图回显信息所示，表示Docker已安装成功。</p><p><img src="https://img.mstudio.top/img/202406302157798.png"></p></li><li><p>执行以下命令，启动Docker服务，并设置开机自启动。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker </span><br><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure></li><li><p>执行以下命令，查看Docker是否启动。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure></li></ol><p>安装docker-compose：（<code>centos7.8</code>不推荐使用，在一些场景会报错，推荐适用老版本的安装方式）</p><ol><li><p>运行以下命令，安装<code>setuptools</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install -U pip setuptools</span><br></pre></td></tr></table></figure></li><li><p>运行以下命令，安装<code>docker-compose</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install docker-compose</span><br></pre></td></tr></table></figure></li><li><p>运行以下命令，验证<code>docker-compose</code>是否安装成功。（这里会提示一个警告，可以忽略，大概意思就是python版本太低，）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure></li></ol><p>docker的安装具体参考阿里云：<a href="https://help.aliyun.com/zh/ecs/use-cases/install-and-use-docker-on-a-linux-ecs-instance">https://help.aliyun.com/zh/ecs/use-cases/install-and-use-docker-on-a-linux-ecs-instance</a></p><h1 id="安装acme"><a href="#安装acme" class="headerlink" title="安装acme"></a>安装acme</h1><p>acme官网<code>Github</code>：<a href="https://github.com/acmesh-official/acme.sh">https://github.com/acmesh-official/acme.sh</a></p><p>首先确认您域名使用的<code>DNS</code>服务商，不同的<code>DNS</code>服务商对应的命令是不同的。比如这里使用的腾讯云的<code>DNSPro</code>解析域名服务。</p><p>安装：（这里一定要带上自己的邮箱，否则后面会报错，会有记录报错，需要多试几次）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh -s email=&quot;xxxx@qq.com&quot;</span><br></pre></td></tr></table></figure><p>这个命令安装acme并且创建了一个 <code>cronjob</code>, 每天 <code>0:00</code> 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书.</p><blockquote><p>注意：<strong>安装好之后建议重新连接服务期</strong>，如果这个时候直接使用<code>acme.sh</code>可能有问题</p></blockquote><h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><p>下面是示例的讲解：</p><p>生成证书：（这里我们使用<code>DNSAPi</code>的高阶用法生成证书）</p><p>更高阶的用法：<a href="https://github.com/acmesh-official/acme.sh/wiki/How-to-issue-a-cert">https://github.com/acmesh-official/acme.sh/wiki/How-to-issue-a-cert</a></p><p><code>DNS APi</code>：<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">https://github.com/acmesh-official/acme.sh/wiki/dnsapi</a></p><p>以下是<code>cloudflare</code>的生成证书方式：（<code>cloudflare</code>的<code>DNS</code>有个坑，后面介绍）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export CF_Key=&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class="line">export CF_Email=&quot;xxxx@qq.com&quot;</span><br><span class="line">acme.sh --issue --dns dns_cf -d example.com -d  *.example.com</span><br></pre></td></tr></table></figure><p>以下是<code>DNSPro</code>的生成证书方式：(注意申请的是<code>DNSPro</code>的令牌不是腾讯云的令牌)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export DP_Id=&quot;XXXX&quot;</span><br><span class="line">export DP_Key=&quot;XXXXXXXXXXXXX&quot;</span><br><span class="line">acme.sh --issue --dns dns_dp -d example.top -d *.example.top</span><br></pre></td></tr></table></figure><p>至此，证书签发完成。</p><h1 id="安装Nginx容器"><a href="#安装Nginx容器" class="headerlink" title="安装Nginx容器"></a>安装<code>Nginx</code>容器</h1><h2 id="流程梳理"><a href="#流程梳理" class="headerlink" title="流程梳理"></a>流程梳理</h2><div class="note purple no-icon flat"><ol><li>创建<code>home/keys</code>文件夹，存放<code>Https</code>证书文件</li><li>创建随机的密钥</li><li>创建容器的局域网段https</li><li>创建<code>/home/keys/nginx/conf.d</code>文件夹,存放<code>nginx</code>的配置文件</li><li>创建<code>nginx.conf</code>文件,并上传到服务器<code>home/nginx</code>文件夹下</li><li>通过<code>docker-cpmpose</code>文件安装<code>Nginx</code></li><li>最后执行<code>acme.sh</code>命令</li></ol></div><blockquote><p>Tip：把所有的配置文件都放在home文件夹下，方便以后管理，目录使用英文并具有一定意义</p></blockquote><h2 id="Https文件存放"><a href="#Https文件存放" class="headerlink" title="Https文件存放"></a>Https文件存放</h2><p>按照上面的流程，我们需要把<code>https</code>证书放到一个可以让<code>nginx</code>容器访问到的地方，这是一个官方的示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d example.top \</span><br><span class="line">--key-file       /path/to/keyfile/in/nginx/key.pem  \</span><br><span class="line">--fullchain-file /path/to/fullchain/nginx/cert.pem \</span><br><span class="line">--reloadcmd     <span class="string">&quot;service nginx force-reload&quot;</span></span><br></pre></td></tr></table></figure><p>(一个小提醒, 这里用的是 <code>service nginx force-reload</code>, 不是 <code>service nginx reload</code>, 据测试, <code>reload</code> 并不会重新加载证书, 所以用的 <code>force-reload</code>)</p><p>因为我们使用的是<code>Docker</code>的方式安装<code>Nginx</code>，所以我们需要修改一下，把目录都放到<code>home</code>目录的<code>key</code>文件夹下（记得域名改为自己的）</p><p>创建文件夹：<code>mkdir /home/keys</code>，存放<code>Https</code>证书文件，这一步只需要创建文件夹，无需执行命令，最后再执行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d example.top \</span><br><span class="line">--key-file       /home/keys/key.pem  \</span><br><span class="line">--fullchain-file /home/keys/cert.pem \</span><br><span class="line">--reloadcmd     <span class="string">&quot;docker restart some-nginx&quot;</span></span><br></pre></td></tr></table></figure><p>这句命令主要为域名创建了两个证书文件，并放在key指定文件夹下，最后重启<code>some-nginx</code>容器</p><h2 id="创建随机的密钥"><a href="#创建随机的密钥" class="headerlink" title="创建随机的密钥"></a>创建随机的密钥</h2><ul><li><p>创建随机的<code>https</code>证书密钥：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl dhparam -out /home/keys/dhparam.pem 2048</span><br></pre></td></tr></table></figure></li></ul><h2 id="创建容器的局域网段"><a href="#创建容器的局域网段" class="headerlink" title="创建容器的局域网段"></a>创建容器的局域网段</h2><p>创建容器的局域网段https：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建容器的局域网段https</span></span><br><span class="line">docker network create https</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是查询network有哪些网段</span></span><br><span class="line">docker network ls</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是查询network里面https网段里面有哪些容器加入进来</span></span><br><span class="line">docker network inspect https</span><br></pre></td></tr></table></figure><h2 id="nginx的配置文件存放"><a href="#nginx的配置文件存放" class="headerlink" title="nginx的配置文件存放"></a><code>nginx</code>的配置文件存放</h2><ul><li><p>创建文件夹：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/nginx</span><br><span class="line">mkdir /home/nginx/conf.d</span><br></pre></td></tr></table></figure></li></ul><h2 id="创建nginx-conf文件"><a href="#创建nginx-conf文件" class="headerlink" title="创建nginx.conf文件"></a>创建<code>nginx.conf</code>文件</h2><ul><li><p>创建<code>nginx.conf</code>文件,并上传到服务器<code>home/nginx</code>文件夹下，这是一个通用的文件配置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span> nginx;</span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">pid</span> /run/nginx.pid;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">65535</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">  <span class="comment"># 设置事件驱动模型，是内核2.6以上支持</span></span><br><span class="line">  <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">  <span class="attribute">worker_connections</span> <span class="number">65535</span>;</span><br><span class="line">  <span class="attribute">accept_mutex</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">multi_accept</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">  <span class="comment"># Basic Settings</span></span><br><span class="line">  <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">send_timeout</span> <span class="number">120</span>;</span><br><span class="line">  <span class="attribute">keepalive_timeout</span> <span class="number">300</span>;</span><br><span class="line">  <span class="attribute">client_body_timeout</span> <span class="number">300</span>;</span><br><span class="line">  <span class="attribute">client_header_timeout</span> <span class="number">120</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">proxy_read_timeout</span> <span class="number">300</span>;</span><br><span class="line">  <span class="attribute">proxy_send_timeout</span> <span class="number">300</span>;</span><br><span class="line">  <span class="comment">#tcp_nopush on;</span></span><br><span class="line">  <span class="attribute">types_hash_max_size</span> <span class="number">4096</span>;</span><br><span class="line">  <span class="attribute">client_header_buffer_size</span> <span class="number">16m</span>;</span><br><span class="line">  <span class="attribute">client_max_body_size</span> <span class="number">4096m</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">include</span> /etc/nginx/mime.types;</span><br><span class="line">  <span class="attribute">include</span> /etc/nginx/conf.d/<span class="regexp">*.conf</span>;</span><br><span class="line">  <span class="comment"># include /usr/share/nginx/modules/*.conf;</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line">  <span class="comment"># Logging Settings</span></span><br><span class="line">  <span class="attribute">access_log</span> /var/log/nginx/access.log;</span><br><span class="line">  <span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log;</span><br><span class="line">  <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">  <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">  <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line">  <span class="comment"># 开启gzip</span></span><br><span class="line">  <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="comment"># 启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span></span><br><span class="line">  <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">  <span class="comment"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明</span></span><br><span class="line">  <span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line">  <span class="comment"># 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。</span></span><br><span class="line">  <span class="attribute">gzip_types</span> text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml;</span><br><span class="line">  <span class="comment"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span></span><br><span class="line">  <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="comment"># 禁用IE 6 gzip</span></span><br><span class="line">  <span class="attribute">gzip_disable</span> <span class="string">&quot;MSIE [1-6]\.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装<code>Nginx</code></h2><ul><li>接下来是<code>Nginx</code>容器安装，编写<code>docker-compose</code>文件：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">&quot;some-nginx&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/conf.d:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/keys:/home/keys</span></span><br><span class="line">      <span class="comment"># blog</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/blog:/var/www</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker network create https</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解释：创建了一个<code>some-nginx</code>的容器，把容器文件<code>nginx.conf</code>、<code>conf.d</code>和keys文件夹挂载出来。暴露端口是80和443；把容器加入到<code>https</code>的网段里面，让这个网段里面的容器可以被<code>nginx</code>容器代理到。</p><p>编写好后就可以直接使用一下命令安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h2 id="执行acme-sh命令"><a href="#执行acme-sh命令" class="headerlink" title="执行acme.sh命令"></a>执行<code>acme.sh</code>命令</h2><p>最后我们就可以运行之前<code>acem</code>的安装命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d example.top \</span><br><span class="line">--key-file       /home/keys/key.pem  \</span><br><span class="line">--fullchain-file /home/keys/cert.pem \</span><br><span class="line">--reloadcmd     &quot;docker resatrt some-nginx&quot;</span><br></pre></td></tr></table></figure><p>正常的话，这里运行着一个<code>nginx</code>容器了，这里的步骤稍微复杂但是细心一点还是没有难度的，特别需要注意的是域名、文件夹和文件名这些内容不要写错。</p><p>截止到这里，基本已经完成基本的架构，只需要其他docker容器加入到https这个网段内，通过conf文件，让nginx这个容器可以访问到就可以了。</p><blockquote><p>TIP：这里在使用<code>docker-compos</code>安装前，需要把<code>Nginx</code>的文件夹先创建好，给目录777权限，<code>nginx.conf</code>是文件，<code>conf.d</code>是文件夹</p></blockquote><h1 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h1><h2 id="静态博客站简单部署"><a href="#静态博客站简单部署" class="headerlink" title="静态博客站简单部署"></a>静态博客站简单部署</h2><p><code>cd</code>到&#x2F;<code>home/nginx/conf.d</code>目录，然后编写文件<code>blog.conf</code>文件，然后放到<code>home</code>目录的<code>nginx</code>的<code>conf.d</code>文件夹下（记得替换域名）</p><p><code>blog.conf</code>文件：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># listen on HTTP2/SSL</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">  <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">  <span class="comment"># ssl certs from letsencrypt</span></span><br><span class="line">  <span class="comment"># ssl on;</span></span><br><span class="line">  <span class="attribute">ssl_certificate</span> /home/keys/cert.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /home/keys/key.pem;</span><br><span class="line">  <span class="comment"># dhparam.pem</span></span><br><span class="line">  <span class="attribute">ssl_dhparam</span> /home/keys/dhparam.pem;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">50m</span>;</span><br><span class="line">  <span class="attribute">ssl_session_timeout</span> <span class="number">30m</span>;</span><br><span class="line">  <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">  <span class="comment"># ciphers chosen for forward secrecy and compatibility</span></span><br><span class="line">  <span class="comment"># http://blog.ivanristic.com/2013/08/configuring-apache-nginx-and-openssl-for-forward-secrecy.html</span></span><br><span class="line">  <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubdomains; preload&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /var/www/;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect HTTP and handle let&#x27;s encrypt requests</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span> www.example.com;</span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在home目录下的<code>blog</code>放静态资源，然后<code>DNS</code>服务商把<code>www</code>网站解析到服务器即可以访问</p><h2 id="安装Jenkins"><a href="#安装Jenkins" class="headerlink" title="安装Jenkins"></a>安装Jenkins</h2><p>使用docker-compose方式安装：</p><p>创建一个名字叫<code>docker-compose.yml</code>的文件:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">jenkins:</span></span><br><span class="line">   <span class="attr">image:</span> <span class="string">jenkins/jenkins:lts</span></span><br><span class="line">   <span class="attr">volumes:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">/home/jenkins/data/:/var/jenkins_home</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/usr/bin/docker:/usr/bin/docker</span></span><br><span class="line">   <span class="attr">ports:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;50000:5000&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;10051:10051&quot;</span>    </span><br><span class="line">   <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">   <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">   <span class="attr">container_name:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">https</span></span><br></pre></td></tr></table></figure><blockquote><p>创建了一个<code>jenkins</code>的最新版本镜像，并创建运行一个叫<code>jenkins</code>容器端口可以挂载也可以不挂载，因为使用的是域名访问，没有影响。</p></blockquote><p>需要给文件夹赋予权限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /home/jenkins/data</span><br></pre></td></tr></table></figure><p>这里我们可以使用<code>ftp</code>工具上传到服务器上的<code>home</code>目录下的<code>jenkins</code>，推荐使用<code>FileZilla Client</code>。</p><p>然后<code>cd</code>到docker-compose的目录下，使用一下命令安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>安装好之后我们需要得到一串密钥文件，输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs  -f jenkins</span><br></pre></td></tr></table></figure><p>可以得到一个密钥，等会安装需要，可以先记录下来，不先安装，先让<code>nginx</code>能代理<code>jenkins</code>容器再来安装。同样的操作的：</p><p><code>jenkins.conf</code>文件：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> target-server &#123;</span><br><span class="line">  <span class="attribute">server</span> jenkins:<span class="number">8080</span> fail_timeout=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># listen on HTTP2/SSL</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">  <span class="attribute">server_name</span> jenkins.example.top;</span><br><span class="line">  <span class="comment"># ssl certs from letsencrypt</span></span><br><span class="line">  <span class="attribute">ssl_certificate</span> /home/keys/cert.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /home/keys/key.pem;</span><br><span class="line">  <span class="comment"># dhparam.pem</span></span><br><span class="line">  <span class="attribute">ssl_dhparam</span> /home/keys/dhparam.pem;</span><br><span class="line">  <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">  <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">  <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&#x27;</span>;</span><br><span class="line">  <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Ssl <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://target-server;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># redirect HTTP and handle let&#x27;s encrypt requests</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">server_name</span> jenkins.example.top;</span><br><span class="line">  <span class="comment"># send everything else to HTTPS</span></span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">302</span> https://jenkins.example.top;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://target-server;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意容器是<code>8080</code>端口的，域名改为自己的。target-server这个根据个人修改，每个应用不能重复</p><p>接下来就是打开域名，访问Jenkins，把刚才的密钥复制粘贴，安装插件，创建用户</p><p>然后需要Jenkins下载下面3个插件：</p><ul><li>Build With Parameters 输入框式的参数</li><li>Persistent Parameter  下拉框式的参数</li><li><code>Gitee</code></li></ul><p>最后再配置<code>Gitee</code>的用户名密码，能然后的项目部署访问到。</p><p>补充：这里后面涉及到项目需要在<code>jengkins</code>使用<code>docker-compos</code>的命令，这里写一下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">进入 Jenkins 容器</span><br><span class="line">docker exec -it jenkins_container_name bash</span><br><span class="line">安装 Docker Compose</span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"> 添加执行权限</span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p><code>jenkins_container_name</code>是自己<code>jenkins</code>的容器名称。</p><h2 id="安装Halo"><a href="#安装Halo" class="headerlink" title="安装Halo"></a>安装Halo</h2><p>由于小型的服务器可能承受不住Halo和mysql的压力，这里演示的是H2数据库：</p><p>这是官方提供的docker-compose文件：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">halo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.fit2cloud.com/halo/halo:2.17</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure:3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./halo2:/root/.halo2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8090:8090&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:8090/actuator/health/readiness&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span>          </span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="comment"># 外部访问地址，请根据实际需要修改</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--halo.external-url=http://localhost:8090/</span></span><br></pre></td></tr></table></figure><p>但是我们安装这个文件安装，可能就会报错，版本原因（start_period是有版本限制的），这里我们需要优化调整一下：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">halo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.fit2cloud.com/halo/halo:2.17.2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure:3</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">test</span>  <span class="comment">#容器名称</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">https:</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/halo2/halo2:/root/.halo2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8090:8090&quot;</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:8090/actuator/health/readiness&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span>          </span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="comment"># 外部访问地址，请根据实际需要修改</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--halo.external-url=https://test.test.top</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">https</span></span><br></pre></td></tr></table></figure><p>增加了container_name（自定义容器名称，方便接下来的Nginx容器访问），剔除了start_period（主要报错原因，版本问题），增加了networks（加入https网段，和Nginx容器同个网段，可以相互之间通讯访问）</p><p>安装好Halo容器，最后就需要使用Nginx来代理这个容器，我们可以编写一个conf文件，存放到home&#x2F;nginx&#x2F;conf.d目录下，这样就可以使Nginx容器代理Halo容器了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">upstream halo-server &#123;</span><br><span class="line">  server test:8090 fail_timeout=0;</span><br><span class="line">&#125;</span><br><span class="line"># listen on HTTP2/SSL</span><br><span class="line">server &#123;</span><br><span class="line">  listen 443 ssl http2;</span><br><span class="line">  server_name test.test.top;</span><br><span class="line"></span><br><span class="line">  # ssl certs from letsencrypt</span><br><span class="line">  ssl_certificate /home/keys/cert.pem;</span><br><span class="line">  ssl_certificate_key /home/keys/key.pem;</span><br><span class="line">  # dhparam.pem</span><br><span class="line">  ssl_dhparam /home/keys/dhparam.pem;</span><br><span class="line">  ssl_session_timeout 5m;</span><br><span class="line">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">  ssl_ciphers &#x27;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&#x27;;</span><br><span class="line">  ssl_prefer_server_ciphers on;</span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_set_header X-Forwarded-Ssl on;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">    proxy_set_header Host $host:$server_port;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_pass http://land-server;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># redirect HTTP and handle let&#x27;s encrypt requests</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name test.test.top;</span><br><span class="line">  # send everything else to HTTPS</span><br><span class="line">  location / &#123;</span><br><span class="line">    return 302 https://test.test.top;</span><br><span class="line">    proxy_set_header Host $host:$server_port;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    proxy_pass http://halo-server;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要修改地方：</p><ul><li>proxy_pass <a href="http://halo-server/">http://halo-server</a> 是 和 halo-server对应的</li><li>return 302 <a href="https://test.test.top/">https://test.test.top</a> 填写自己的域名</li><li>server_name test.test.top; 填写自己的域名</li><li>server test:8090 fail_timeout&#x3D;0; 填写自己容器名称</li></ul><h2 id="自动化部署Hexo博客"><a href="#自动化部署Hexo博客" class="headerlink" title="自动化部署Hexo博客"></a>自动化部署Hexo博客</h2><p><code>hexo</code>上传代码需要以下插件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>需要改动<code>hexo</code>配置文件：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">yougitproject</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>上传git代码还需要配置ssh的密钥，同时还需要配置本地的账户名和邮箱</p><p>本地生成SSH密钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>配置git本地的账户名和邮箱</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;Git用户名&quot; </span><br><span class="line">git config --global user.email &quot;Git邮箱&quot;</span><br></pre></td></tr></table></figure><p><strong>本地编写<code>DockerFile</code></strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span> as build-stage</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=LSF</span></span><br><span class="line"><span class="comment"># 创建一个工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN npm install --registry=https://registry.npm.taobao.org</span></span><br><span class="line"><span class="comment"># RUN npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> nginx:stable-alpine as production-stage</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build-stage /app /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><strong><code>gitee</code>和<code>jenkins</code>联调</strong></p><ol><li>创建一个自由风格的项目；</li><li>然后选择参数化构建过程，有4个参数，分别是写container_name、port、image_name、tag，类型写String；</li><li>源码管理Git填写代码仓库地址。（注意要配置好Gitee的凭据）；</li><li>勾选<code>Gitee webhook</code> 触发构建，生成<code>Gitee WebHooks</code> 密码，然后在·仓库的·那里填写这个url和密码，其他可以保持默认；</li><li>最后构建过程选择执行shell。</li></ol><p>shell脚本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">CONTAINER=$&#123;container_name&#125;</span><br><span class="line">PORT=$&#123;port&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">build docker image</span></span><br><span class="line">docker build --no-cache -t $&#123;image_name&#125;:$&#123;tag&#125; .</span><br><span class="line"></span><br><span class="line">checkDocker() &#123;</span><br><span class="line">  RUNNING=$(docker inspect --format=&quot;&#123;&#123; .State.Running &#125;&#125;&quot; $CONTAINER 2&gt;/dev/null)</span><br><span class="line">  if [ -z $RUNNING ]; then</span><br><span class="line">    echo &quot;$CONTAINER does not exist.&quot;</span><br><span class="line">    return 1</span><br><span class="line">  fi</span><br><span class="line"></span><br><span class="line">  if [ &quot;$RUNNING&quot; == &quot;false&quot; ]; then</span><br><span class="line">    matching=$(docker ps -a --filter=&quot;name=$CONTAINER&quot; -q | xargs)</span><br><span class="line">    if [ -n $matching ]; then</span><br><span class="line">      docker rm $matching</span><br><span class="line">    fi</span><br><span class="line">    return 2</span><br><span class="line">  else</span><br><span class="line">    echo &quot;$CONTAINER is running.&quot;</span><br><span class="line">    matchingStarted=$(docker ps --filter=&quot;name=$CONTAINER&quot; -q | xargs)</span><br><span class="line">    if [ -n $matchingStarted ]; then</span><br><span class="line">      docker stop $matchingStarted</span><br><span class="line">      docker rm $&#123;container_name&#125;</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">checkDocker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run docker image</span></span><br><span class="line">docker run -it d --name $CONTAINER -p $PORT:80 $&#123;image_name&#125;:$&#123;tag&#125;</span><br></pre></td></tr></table></figure><p>这样基本就搭建完成，本店只要通过<code>hexo g</code>命令上传代码，<code>jenkins</code>就可以自动构建部署了，因为没有使用docker-compose文件所以这里需要shell脚本，后面使用docker-compose就不需要这么复杂的shell脚本</p><p><code>nginx</code>的配置文件与<code>jenkins</code>一样，需要修改域名，target-server和注意容器的端口</p><h2 id="自动化部署Vue前端项目"><a href="#自动化部署Vue前端项目" class="headerlink" title="自动化部署Vue前端项目"></a>自动化部署Vue前端项目</h2><p><strong>项目根目录本地编写<code>DockerFile</code>和<code>docker-compose</code>文件</strong></p><p><code>DockerFile</code>文件</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span> as build-stage</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=Tech</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install --registry=https://registry.npmmirror.com --legacy-peer-deps</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> nginx:stable-alpine as production-stage</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build-stage /app/dist /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><code>docker-compose</code>文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">Version:</span> <span class="number">1.0</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vueprojrctimg:1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vueprojrct</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10000</span><span class="string">:80</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">https</span></span><br></pre></td></tr></table></figure><p><strong><code>gitee</code>和<code>jenkins</code>联调</strong></p><p>与自动化部署Hexo博客一样，但是去除掉参数化和改shell脚本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker-compose up --build</span><br></pre></td></tr></table></figure><p><code>nginx</code>的配置文件与<code>jenkins</code>一样，需要修改域名，target-server和注意容器的端口</p><h2 id="自动化部署NodeJS项目"><a href="#自动化部署NodeJS项目" class="headerlink" title="自动化部署NodeJS项目"></a>自动化部署NodeJS项目</h2><p><strong>本地编写<code>DockerFile</code>和<code>docker-compose</code>文件</strong></p><p><strong>项目根目录本地编写<code>DockerFile</code>和<code>docker-compose</code>文件</strong></p><p><code>DockerFile</code>文件</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">20</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=Tech</span></span><br><span class="line"><span class="comment"># 创建一个工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install --registry=https://registry.npmmirror.com --legacy-peer-deps</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">12006</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [ <span class="string">&quot;/app/public&quot;</span> ] <span class="comment">#不一定挂载出来</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;node&quot;</span>, <span class="string">&quot;dist/bundle.js&quot;</span> ]</span></span><br></pre></td></tr></table></figure><p><code>docker-compose</code>文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="attr">Version:</span> <span class="number">1.0</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nodeprojrctimg:1.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nodeprojrct</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10001</span><span class="string">:3000</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">https</span></span><br></pre></td></tr></table></figure><p><strong><code>gitee</code>和<code>jenkins</code>联调</strong></p><p>与自动化部署Hexo博客一样，但是去除掉参数化和改shell脚本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker-compose up --build</span><br></pre></td></tr></table></figure><p><code>nginx</code>的配置文件与<code>jenkins</code>一样，需要修改域名，target-server和注意容器的端口</p><h1 id="可能用到的工具"><a href="#可能用到的工具" class="headerlink" title="可能用到的工具"></a>可能用到的工具</h1><p>这里列举了我常用的开发工具和连接服务器工具链接</p><ul><li>VsCode:<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li><li>Git:<a href="https://git-scm.com/">https://git-scm.com/</a></li><li>PicGo:<a href="https://picgo.github.io/PicGo-Doc/zh/">https://picgo.github.io/PicGo-Doc/zh/</a></li><li>Snipaste:<a href="https://zh.snipaste.com/">https://zh.snipaste.com/</a></li><li>FileZilla Client: <a href="https://www.filezilla.cn/">https://www.filezilla.cn/</a></li></ul><h1 id="一些踩过的坑！！"><a href="#一些踩过的坑！！" class="headerlink" title="一些踩过的坑！！"></a>一些踩过的坑！！</h1><p>在部署的时候遇到一个巨坑，因为使用的是<code>cloudflare</code>进行·解析，但是有一个断到断的加密过程，看下面图片就知道了，用户访问会被<code>cloudflare</code>先代理，走<code>https</code>，但是<code>cloudflare</code>跟服务器也要走<code>https</code>，不能走<code>http</code>，不然就会出现前端重定向问题！这里一般选择完全的<code>SSL</code>加密</p><p><img src="https://img.mstudio.top//img/202407051650059.png"></p><p>如果是使用cloudflare代理的网站，在安装halo后可能会遇到插件和应用商店看不到的问题，这需要在cloudflare后台缓存-&gt;配置-&gt;缓存级别改为标准，这也是一个巨坑！</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul><li><p>服务器端密钥登录</p></li><li><p>Docker和<code>DockerCompose</code>的安装</p></li><li><p>acme的安装过程</p></li><li><p><code>Nginx</code>安装和acme的配置</p></li><li><p>不同的方式安装docker容器项目，实现自动化部署集成并支持<code>https</code>访问</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue基础入门</title>
      <link href="/posts/b00f8cd6.html"/>
      <url>/posts/b00f8cd6.html</url>
      
        <content type="html"><![CDATA[<div class="note blue no-icon flat"><p>大学刚毕业那会，接触过vue2，之后不久的2019年左右，vue3就面世了，引入了很多新特性，后来因为就业原因，没有进入IT行业，就没有接触过Vue，今天先用一篇文章，从“零基础”开始学习vue和vue3新特性，先在这里写好文章骨架，后续慢慢补充优化吧。</p></div><div class="note orange no-icon flat"><p>文章代码只展示最主要的部分，完整代码会放在这个github仓库：<a href="https://github.com/geekland339/Vue_Example">Vue_Example</a></p></div><h1 id="语法初探"><a href="#语法初探" class="headerlink" title="语法初探"></a>语法初探</h1><div class="note blue no-icon flat"><p>通过编写几个小的Demo，了解Vue的v-if指令、 v-on指令、v-for指令、methods、mounted函数，双向绑定等基础知识点</p></div><h2 id="编写-HelloWorld-和-Counter"><a href="#编写-HelloWorld-和-Counter" class="headerlink" title="编写 HelloWorld 和 Counter"></a>编写 HelloWorld 和 Counter</h2><div class="note orange no-icon flat"><p>编写Vue的HelloWorld程序和Counter定时器</p></div><p><code>HelloWorld.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">   <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">     <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="attr">msg</span>: <span class="string">&#x27;Hello,Vue&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">       &#125;;</span></span><br><span class="line"><span class="language-javascript">     &#125;,</span></span><br><span class="line"><span class="language-javascript">   <span class="comment">//template: &#x27;&lt;div&gt;hello，Vue2&lt;/div&gt;&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">   &#125;);</span></span><br><span class="line"><span class="language-javascript">   app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>上面这段代码中，Vue.createApp创建了Vue的实例，使用 const app去接收Vue的实例化对象，然后挂载在id为app的标签上，其中msg是响应式数据，msg改变，页面上面的msg也会改变。当然，也可以使用template模板，这是最简单的HelloWorld 应用。</p></div><p><code>Counter.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123;counter&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">counter</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">counter</span> += <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>这是一个计时器的例子，mounted是Vue的生命周期函数，在Vue组件挂载的时候自动执行，setInterval是定时函数，每秒对counter加1，当页面加载的时候，自动执行setInterval函数。此时页面上每秒就会加1操作</p></div><h2 id="编写字符串反转和内容隐藏"><a href="#编写字符串反转和内容隐藏" class="headerlink" title="编写字符串反转和内容隐藏"></a>编写字符串反转和内容隐藏</h2><div class="note orange no-icon flat"><p>编写字符串反转和内容隐藏，了解vue的响应式、v-if指令和 v-on指令</p></div><p><code>StrReverse.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;msg&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;reverseclick&quot;</span>&gt;</span>点击反转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 实例化Vue</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">msg</span>: <span class="string">&#x27;helloWorld&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">reverseclick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 把msg倒置后赋值给msg</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="variable language_">this</span>.<span class="property">msg</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 挂载到app的DOM节点</span></span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><ul><li>使用 <code>methods</code> 属性给 Vue 定义方法reverseclick，当点击按钮的时候，触发reverseclick方法，反转msg</li><li>v-on：给元素绑定事件监听器；缩写：<code>@</code>；</li></ul></div><p><code>IsShow.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;isshowclick&quot;</span>&gt;</span>显示/隐藏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 实例化Vue</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">isshowclick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">show</span> = !<span class="variable language_">this</span>.<span class="property">show</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 挂载到app的DOM节点</span></span></span><br><span class="line"><span class="language-javascript">  app.<span class="property">moun</span></span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>通过v-if根据show变量，控制元素的显示与隐藏，</p></div><div class="note orange no-icon flat"><ul><li><p>v-if：基于表达式值的真假性，来条件性地渲染元素或者模板片段</p></li><li><p>与v-if一样的效果有v-show，两者的区别是：v-if会根据条件是否渲染DOM结构，v-show不管条件是否都会渲染DOM结构，然后再根据条件判断是否显示隐藏DOM结构。</p></li></ul></div><h2 id="编写TodoList"><a href="#编写TodoList" class="headerlink" title="编写TodoList"></a>编写TodoList</h2><div class="note orange no-icon flat"><p>编写TodoList 的功能，了解双向绑定和循环。</p></div><p><code>TodoList.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;addclick&quot;</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;li v-for=&quot;(item,index) of list &quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;li v-for=&quot;item in list&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,a) of list &quot;</span>&gt;</span>&#123;&#123;a&#125;&#125;-----&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 实例化Vue</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">list</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: <span class="string">&#x27;这是一个title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addclick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加后置空</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 挂载到app的DOM节点</span></span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>利用双向绑定input文字，点击方法addclick方法后把msg添加到数组list，最后使用v-for循环数组，循环数组可以把数组的下表也循环出来，在第二个参数，通常使用index表示，数组下标从0开始。</p></div><div class="note orange no-icon flat"><p>v-bind可以绑定标签的属性，在data修改标签的属性值。</p></div><h2 id="组件概念初探"><a href="#组件概念初探" class="headerlink" title="组件概念初探"></a>组件概念初探</h2><div class="note orange no-icon flat"><p>改写todolist示例，可以把li部分封装成一个组件，并且让这两个组件之间可以数据通讯。</p></div><p><code>TodoListComp.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;addclick&quot;</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">todo-list</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-for</span>=<span class="string">&quot;(item,index) of list&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-bind:item</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-bind:index</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">todo-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 实例化Vue</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">list</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: <span class="string">&#x27;这是一个title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">addclick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加后置空</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">component</span>(<span class="string">&#x27;todo-list&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 接受父组件传递过来的数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: [<span class="string">&#x27;item&#x27;</span>, <span class="string">&#x27;index&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">template</span>: <span class="string">&#x27;&lt;li&gt;&#123;&#123;index&#125;&#125;-----&#123;&#123;item&#125;&#125;&lt;/li&gt;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 挂载到app的DOM节点</span></span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>上面的示例中，把li标签的重新封装成单独一个组件，使用app.component组成为全局组件，组件之间的通讯可以使用v-bind绑定属性，向子组件传递数据，子组件使用props接受父组件数据。</p></div><div class="note orange no-icon flat"><ul><li>一个网页，可以看做成由一个一个的组件组成，一个组件内部可以由多个子组件组成；</li><li>对于一些常用的组件，我们可以封装成单独一个组件，给其他组件使用；</li><li>封装的组件需要具有低耦合性，也就是封装的组件内部不要有过多的逻辑，字组件的变化，应该由外部组件来影响；</li></ul></div><h1 id="Vue基础语法"><a href="#Vue基础语法" class="headerlink" title="Vue基础语法"></a>Vue基础语法</h1><div class="note blue no-icon flat"><p>经过前面的Demo了解了Vue的基本知识点，这章更进一步了解Vue的基础语法，包括组件概念、生命周期函数、常用的模板语法、计算属性computed、监听属性watch、样式的绑定、条件和循环渲染、事件的绑定和修饰符等基础语法内容。</p></div><h2 id="Vue中应用和组件的基础概念"><a href="#Vue中应用和组件的基础概念" class="headerlink" title="Vue中应用和组件的基础概念"></a>Vue中应用和组件的基础概念</h2><p> <code>vm.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// createApp表示创建一个vue应用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 传入的参数表示这个应用最外层的组件，应该如何展示</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// mvvm 设计模式 m -&gt;model 数据;v-&gt;view 视图;vm-&gt;viewModel 视图数据连接层</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&#x27;hello vue&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;&#123;&#123;message&#125;&#125;&lt;/div&gt;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// vm代表就是vue的应用根组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>Vue是数据和视频的连接层，数据和视图交由我们编写，vue负责viewModel层，这样也少了操作DOM，只需要关注数据和页面的代码。</p></div><h2 id="生命周期函数概念"><a href="#生命周期函数概念" class="headerlink" title="生命周期函数概念"></a>生命周期函数概念</h2><div class="note orange no-icon flat"><p>生命周期函数就是在<strong>某一时刻自动执行</strong>的函数，下面是官方的图片：</p></div><p><img src="https://cn.vuejs.org/assets/lifecycle_zh-CN.W0MNXI0C.png" alt="img"></p><div class="note purple no-icon flat"><ul><li>在Vue.createApp之后，Vue首先会初始化setup（组合式api的内容），分析绑定事件生命周期函数之后，执行第一个生命周期函数beforeCreate。</li><li>执行beforeCreate后，Vue会初始化选项式API，分析数据和模板之间绑定的数据，然后执行created，此时DOM还没有挂载。</li><li>执行created后，此时Vue的实例初始化完成，Vue会去判断是否存在template，存在就编译成render函数，没有则使用Html作为模版编译，然后执行beforeMount，此时DOM还没有挂载</li><li>执行beforeMount后，会把Vue实例挂载到DMO上，然后执行mounted，此时组件已经渲染到页面。</li><li>当组件的data数据发生改变，beforeUpdate会首先自动执行，然后Vue会重新渲染。数据改变-&gt;beforeUpdate-&gt;Vue渲染。</li><li>当组件的data数据发生改变并且页面已经完成更新后，updated会自动执行。</li><li>当Vue实例销毁时，会执行beforeUnmount，此时DOM并没有完全销毁，执行完beforeUnmount，Vue才会销毁页面的DOM结构。</li><li>当Vue实例销毁并且DOM销毁后，Vue会执行unmounted，此时vue的生命周期结束</li></ul></div><p><code>template.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//在实例生成之前会自动执行的函数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is beforeCreate&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在实例生成之后会自动执行的函数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this is created&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//在组件渲染到页面之前自动执行的函数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is beforeMount&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在组件渲染到页面之后自动执行的函数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is mounted&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在data中数据发生改变的时候立即执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is beforeUpdate&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在data中数据发生改变，同时页面已经更新完成，立即执行的函数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is updated&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当Vue失效时会自动执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is beforeUnmount&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当Vue失效并且DOM销毁时会自动执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> doc = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc + <span class="string">&#x27;this is unmounted&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&#x27;生命周期函数实例，请打开控制台&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vm代表就是vue的应用根组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="常用模版语法"><a href="#常用模版语法" class="headerlink" title="常用模版语法"></a>常用模版语法</h2><div class="note purple no-icon flat"><ul><li>v-html：不对变量上的标签进行转义，直接输出html</li><li>v-bind：标签属性值是变量的时候，需要使用v-bind绑定标签属性</li><li>v-once：在数据改变的时候，不会重新渲染，还是使用的初始值data</li><li>v-if：判断条件，true则渲染DOM，false则不渲染DOM</li><li>v-on：事件绑定</li></ul></div><div class="note orange no-icon flat"><ul><li>v-on：v-on的缩写可以写成@</li><li>v-bind：v-on的缩写可以写成 :</li></ul></div><h2 id="数据、方法、计算属性和侦听器"><a href="#数据、方法、计算属性和侦听器" class="headerlink" title="数据、方法、计算属性和侦听器"></a>数据、方法、计算属性和侦听器</h2><div class="note purple no-icon flat"><p>vue的数据可以写在data部分，方法可以写在method部分，计算属性computed只有依赖的属性值发生改变的时候才会重新计算，而method方法只要触发了就会执行，computed可以节省资源的浪费，watch监听器可以监听数值的变化，数值变化会自动执行，可以接受新的值和旧的值两个参数，根据官方的文档，当需要在数据变化时执行异步或开销较大的操作时，watch这个方式是最有用的。</p></div><p><code>computed.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;total&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">// 当pricd发生改变的时候，重新计算</span></span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">pricd</span>(<span class="params">newval, oldval</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="property">newtotal</span> = newval + count;</span></span><br><span class="line"><span class="language-javascript">           <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发生改变新的值&#x27;</span> + newval + <span class="string">&#x27;旧的值&#x27;</span> + oldval);</span></span><br><span class="line"><span class="language-javascript">           &#125;, <span class="number">3000</span>);</span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">       <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">// 当计算属性的内容发生变更时，才会重新计算</span></span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">total</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="keyword">return</span> <span class="title class_">Date</span>.<span class="title function_">now</span>();</span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// return this.count + this.pricd;</span></span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">       <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">count</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">pricd</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">newtotal</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">         &#125;;</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">       <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">gettotal</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// 当页面重新渲染的时候，才会重新计算</span></span></span><br><span class="line"><span class="language-javascript">           <span class="keyword">return</span> <span class="title class_">Date</span>.<span class="title function_">now</span>();</span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// return this.count + this.pricd;</span></span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">     &#125;);</span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="样式绑定语法"><a href="#样式绑定语法" class="headerlink" title="样式绑定语法"></a>样式绑定语法</h2><div class="note orange no-icon flat"><p>通过:style和:class可以绑定CSS样式。通过:style绑定的样式也可以在data中使用对象的方式编写。</p></div><p><code>Style.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">   <span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css">     <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">   &#125;</span></span><br><span class="line"><span class="language-css"> </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      const app = Vue.createApp(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        data() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          return &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            message: &#x27;hello vue&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            classStr: &#x27;red&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            styleStr: &#x27; color: blue&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            styleObj: &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">              color: &#x27;orange&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">              background: &#x27;yellow&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          &#125;;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        template:</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleStr&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;classStr&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleObj&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      &#125;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      // vm代表就是vue的应用根组件</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      const vm = app.mount(&#x27;#app&#x27;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h2><div class="note orange no-icon flat"><p>v-if根据判断条件，来控制DOM元素的存在与否，如果是则DOM渲染，如果否则DOM不渲染，有一个跟v-if相似的叫v-show，v-show不管条件与否都会渲染DOM结构，然后通过display来控制元素是否展示，在一些需要频繁展示隐藏的情况下，v-show更有优势，在一些不频繁展示隐藏的情况下，v-if更有优势</p></div><p><code>show.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    const app = Vue.createApp(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      data() &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        return &#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          message: &#x27;v-if&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          msg: &#x27;show&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">          show: false,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      &#125;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">      template:</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">msg</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    &#125;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    // vm代表就是vue的应用根组件</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    const vm = app.mount(&#x27;#app&#x27;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="列表循环渲染"><a href="#列表循环渲染" class="headerlink" title="列表循环渲染"></a>列表循环渲染</h2><div class="note orange no-icon flat"><ul><li>在Vue中需要循环渲染一个数组，可以使用v-for，v-for除了可以渲染数组外，也可以循环对象；</li><li>在vue3中，v-if和v-for在同一个标签时候，v-for的优先级会更高，所以需要在v-for后面一层添加v-if；</li><li>而在在vue2中，v-if和v-for在同一个标签时候，v-if会比v-for优先级更高，会先判断再循环；</li><li>无论哪一种，都不建议这么做，因为会带来性能方面的浪费。</li></ul></div><p><code>list.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in listArr&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- lee不显示 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;item !== &#x27;lee&#x27;&quot;</span>&gt;</span>&#123;&#123;index&#125;&#125;---&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addArr()&quot;</span>&gt;</span>数组按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key) in listboj&quot;</span>&gt;</span>&#123;&#123;key&#125;&#125;---&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addObj()&quot;</span>&gt;</span>对象按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in 10&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 5不显示 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;item !==5 &quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;---<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">listArr</span>: [<span class="string">&#x27;dell&#x27;</span>, <span class="string">&#x27;lee&#x27;</span>, <span class="string">&#x27;teacher&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">listboj</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">name</span>: <span class="string">&#x27;dell&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">lastname</span>: <span class="string">&#x27;lee&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">job</span>: <span class="string">&#x27;teacher&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">           &#125;,</span></span><br><span class="line"><span class="language-javascript">         &#125;;</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">       <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">addArr</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="property">listArr</span>.<span class="title function_">push</span>(<span class="string">&#x27;hello&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// this.listArr.pop();</span></span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// this.listArr.shift();</span></span></span><br><span class="line"><span class="language-javascript">           <span class="comment">// this.listArr.unshift(&#x27;hello&#x27;);</span></span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">         <span class="title function_">addObj</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="property">listboj</span>.<span class="property">new</span> = <span class="string">&#x27;newval&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">         &#125;,</span></span><br><span class="line"><span class="language-javascript">       &#125;,</span></span><br><span class="line"><span class="language-javascript">       <span class="attr">template</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">     &#125;);</span></span><br><span class="line"><span class="language-javascript">     <span class="comment">// vm代表就是vue的应用根组件</span></span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><div class="note orange no-icon flat"><p>事件修饰符：</p><ul><li>@click事件事件后面可以接表达式</li><li>点击事件带有默认参数有event，如果添加了参数，可以在方法名参数写上$event</li><li>一个标签上存在多个事件点击需要写上括号，如： <code>@click=&quot;add(),add1()&quot;</code></li><li>@click.stop可以阻止点击事件冒泡。</li><li>事件修饰符还有：prevevt、capture、self、once、passive</li></ul></div><div class="note purple no-icon flat"><p>按键修饰符：</p><ul><li>@keydown是按键事件</li><li>.enter是指按回车的时候执行</li><li>按键修饰符还有：tab、delete、esc、up、down、left、right</li></ul></div><div class="note blue no-icon flat"><p>鼠标修饰符：</p><ul><li>@click后面可以加鼠标修饰符</li><li>鼠标修饰符有：left、right、middle</li></ul></div><div class="note red no-icon flat"><p>存疑！！！：以下代码为按住ctrl键并点击的时候触发事件，如果按住ctrl和A键，再点击同样也会触发事件，如果想只按住ctrl再点击才有效可以使用.exact。</p></div><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.ctrl.exact</span>=<span class="string">&quot;addclick&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="表单中双向绑定指令的使用"><a href="#表单中双向绑定指令的使用" class="headerlink" title="表单中双向绑定指令的使用"></a>表单中双向绑定指令的使用</h2><p>官方文档：<a href="https://cn.vuejs.org/guide/essentials/forms.html">https://cn.vuejs.org/guide/essentials/forms.html</a></p><div class="note orange no-icon flat"><p>表单双向绑定：</p><ul><li>input框中的text、checkbox、radio、number等都可以使用 v-model双向绑定</li><li>checkbox可以通过true-value、false-value自定义选中时候显示文字</li><li>select也可以双向绑定，多选可以使用multiple</li><li>option里面的value可以存放对象值</li></ul></div><div class="note blue no-icon flat"><p>表单修饰符：</p><ul><li>v-model.lazy，鼠标移出输入框点击时触发</li><li>v-model.number，修饰符会在输入框有 type&#x3D;”number” 时自动启用。</li><li>v-model.trim，去除输入框前后空格</li></ul></div><h1 id="组件的理念"><a href="#组件的理念" class="headerlink" title="组件的理念"></a>组件的理念</h1><h2 id="组件的定义及复用性"><a href="#组件的定义及复用性" class="headerlink" title="组件的定义及复用性"></a>组件的定义及复用性</h2><div class="note orange no-icon flat"><p><strong>Vue组件</strong>是Vue.js框架中最强大的功能之一。它们是可复用的Vue实例，可以封装HTML、CSS和JavaScript代码，使代码更易于维护和扩展。</p><p>网页可以理解为一块一块的组件拼装起来</p></div><div class="note blue no-icon flat"><p>Vue可以通过 app.component全局注册组件，该组件可以重复使用，数据逻辑互不干扰</p></div><h2 id="局部组件和全局组件"><a href="#局部组件和全局组件" class="headerlink" title="局部组件和全局组件"></a>局部组件和全局组件</h2><div class="note orange no-icon flat"><p>Vue可以全局组成组件，全局组件可以在任何其他组件使用，缺点是性能降低，不管组件有没有使用，都会挂载在Vue实例上，Vue也可以局部注册组件，组件只能在注册的父组件使用。建议大写字母开头，使用驼峰命名，局部组件使用时，要做一个名字和组件间的映射关系，不写映射，Vue也会尝试自动映射。</p></div><h2 id="组件间传值及传值校验"><a href="#组件间传值及传值校验" class="headerlink" title="组件间传值及传值校验"></a>组件间传值及传值校验</h2><h2 id="单项数据流的理解"><a href="#单项数据流的理解" class="headerlink" title="单项数据流的理解"></a>单项数据流的理解</h2><h2 id="Non-Props-属性是什么"><a href="#Non-Props-属性是什么" class="headerlink" title="Non-Props 属性是什么"></a>Non-Props 属性是什么</h2><h2 id="父子组件间如何通过事件进行通信"><a href="#父子组件间如何通过事件进行通信" class="headerlink" title="父子组件间如何通过事件进行通信"></a>父子组件间如何通过事件进行通信</h2><h2 id="组件间双向绑定高级内容"><a href="#组件间双向绑定高级内容" class="headerlink" title="组件间双向绑定高级内容"></a>组件间双向绑定高级内容</h2><h2 id="使用插槽和具名插槽解决组件内容传递问题"><a href="#使用插槽和具名插槽解决组件内容传递问题" class="headerlink" title="使用插槽和具名插槽解决组件内容传递问题"></a>使用插槽和具名插槽解决组件内容传递问题</h2><h2 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h2><h2 id="动态组件和异步组件"><a href="#动态组件和异步组件" class="headerlink" title="动态组件和异步组件"></a>动态组件和异步组件</h2><h2 id="基础语法知识点查缺补漏"><a href="#基础语法知识点查缺补漏" class="headerlink" title="基础语法知识点查缺补漏"></a>基础语法知识点查缺补漏</h2><h1 id="Vue-中的动画"><a href="#Vue-中的动画" class="headerlink" title="Vue 中的动画"></a>Vue 中的动画</h1><p>单组件元素的动画实现<br>列表动画的实现<br>状态动画的实现<br>CSS 动画与JS 动画</p><h1 id="Vue-中的高级语法"><a href="#Vue-中的高级语法" class="headerlink" title="Vue 中的高级语法"></a>Vue 中的高级语法</h1><p>Mixin 混入的开发</p><p>Vue 中的自定义指令<br>Teleport 传送门功能<br>更加底层的 render 函数<br>插件的定义和使用</p><h1 id="Composition-API"><a href="#Composition-API" class="headerlink" title="Composition API"></a>Composition API</h1><p>Composition APl 的产生背景<br>setup 函数的使用及参数<br>响应式引用语法<br>计算属性和侦听器的写法<br>案例开发帮你理解新语法</p><h1 id="Vue-项目开发配套工具"><a href="#Vue-项目开发配套工具" class="headerlink" title="Vue 项目开发配套工具"></a>Vue 项目开发配套工具</h1><p>VueCLl 脚手架工具<br>大型工程项目结构单文件组件的使用<br>Vue-Router 入门学习<br>VueX 基础内容学习</p><h1 id="京东到家小项目"><a href="#京东到家小项目" class="headerlink" title="京东到家小项目"></a>京东到家小项目</h1>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> 基础进阶 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>百度收录 Cloudflare Page 显示 308 报错</title>
      <link href="/posts/e2e81a90.html"/>
      <url>/posts/e2e81a90.html</url>
      
        <content type="html"><![CDATA[<div class="note blue no-icon flat"><p>由于博客文章是托管在Giuhub上的，用Cloudflare Page代理，最近在百度收录网站时，频繁遇到308问题或者访问不上问题，起初以为是Cloudflare 外网问题，后来查找多方资料后才明白：Cloudflare Page 会将 <code>.html 文件请求</code> 重定向到 <code>去掉 .html 后缀的地址</code> 。导致百度收录网站时显示网页 308 跳转。</p></div><h1 id="问题的根源"><a href="#问题的根源" class="headerlink" title="问题的根源"></a>问题的根源</h1><div class="note red no-icon flat"><p>Cloudflare Page 会将 <code>.html 文件请求</code> 重定向到 <code>去掉 .html 后缀的地址</code> 。导致百度收录网站时显示网页 308 跳转。也就是跳转到的最终网址是<code>https://geekland.top/xxx</code>,而不是<code>https://geekland.top/xxx.html</code>,这明显不符合百度的收录要求。</p></div><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><div class="note purple no-icon flat"><p>解决方法就是再文件上后缀再加<code>.html</code>,Cloudflare Page 重定向后就会显示 一层 <code>.html</code>。如 Cloudflare Page 文件链接为 <code>https://geekland.top/xxx.html.html</code>。这样访问后重定向后就会显示 <code>https://geekland.top/xxx.html</code>。符合百度验证的要求。</p></div><h1 id="后续问题"><a href="#后续问题" class="headerlink" title="后续问题"></a>后续问题</h1><div class="note purple no-icon flat"><p>如果之前hexo没有配置skip_render，那么经过上面修改文件名之后，大概率还是有问题的，这是因为hexo会把<code>.html.html</code>重新编译，如果您打开public文件夹下的html文件，对比百度下载下来的文件，就会发现不同，这个时候我们需要做的是不让hexo去编译html文件，就需要到hexo的配置文件中的skip_render配置项配置为：<code>skip_render: &#39;*.html.html&#39;</code>，最终重新编译上传就可以了</p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>杂记1</title>
      <link href="/posts/e2f41d03.html"/>
      <url>/posts/e2f41d03.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><div class="note blue no-icon flat"><p>记录最近在配置Hexo博客时，发现或学习到以往没有发现的知识。</p></div><h1 id="善用外挂标签"><a href="#善用外挂标签" class="headerlink" title="善用外挂标签"></a>善用外挂标签</h1><div class="note purple no-icon flat"><p>在之前的hexo文章中，没有使用外挂标签，文字堆叠在一起或比较散乱，即使文章段落分明，但是阅读起来就是没有主次之分，或者印象不深刻，比如以下文字是没有使用外挂标签的</p></div><p>在之前的hexo文章中，没有使用外挂标签，文字总是堆叠在一起，或者比较散乱，看着都没有注意到 重点，比如这段文字是没有使用外挂标签的</p><div class="note purple no-icon flat"><p>有了外挂标签，可以使文章看起来更有段落感，段落标签不仅可以改变颜色，butterfly主题还提供了ICON的标签，以下是一些示例，官方文档：<a href="https://butterfly.js.org/posts/ceeb73f/?highlight=note">标签外挂</a></p></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;</span><br><span class="line">你是刷 Visa 還是 UnionPay</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;</span><br><span class="line">2021 年快到了....</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;</span><br><span class="line">小心開車 安全至上</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; simple%&#125;</span><br><span class="line">這是三片呢？還是四片？</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;</span><br><span class="line">你是刷 Visa 還是 UnionPay</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;</span><br><span class="line">剪刀石頭布</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;</span><br><span class="line">前端最討厭的瀏覽器</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 還是 UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2021 年快到了….</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>小心開車 安全至上</p></div><div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>這是三片呢？還是四片？</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 還是 UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石頭布</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>前端最討厭的瀏覽器</p></div><h1 id="SEO的优化"><a href="#SEO的优化" class="headerlink" title="SEO的优化"></a>SEO的优化</h1><div class="note purple no-icon flat"><p>使用<code>hexo-seo-submit</code>插件，每天自动提交最新文章链接（或本地手动）至搜索引擎，让搜索引擎更快的收录文章。</p></div><p><strong>使用方式：</strong>（举例bing）</p><div class="note purple no-icon flat"><p>安装：<code>npm install hexo-seo-submit</code></p></div><div class="note purple no-icon flat"><p>在根目录中的 _config.yml 中配置插件。</p></div><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hexo-seo-submit:</span></span><br><span class="line">  <span class="attr">CI:</span></span><br><span class="line">    <span class="comment"># cron: 0 4 * * *</span></span><br><span class="line">    <span class="comment"># branch: master # default master</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">baidu:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">google:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">bing:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">https://github.com/&lt;username&gt;/&lt;project&gt;</span></span><br><span class="line">  <span class="comment"># 注意~  </span></span><br><span class="line">  <span class="attr">ignore_hidden:</span> <span class="literal">false</span> <span class="comment"># 忽略隐藏文件及文件夹(目录)</span></span><br></pre></td></tr></table></figure><div class="note purple no-icon flat"><p>在 github仓库中配置环境变量，打开Settings-&gt;Secrets and variables-&gt;Actions-&gt;New repository secret，把bing的令牌填上，name为BING_APIKEY，Secret为令牌</p></div><div class="note purple no-icon flat"><p>获取Bing的令牌，设置-&gt;API访问-&gt;API密钥</p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hexo butterfly主题添加对随机图片api的支持</title>
      <link href="/posts/69f20526.html"/>
      <url>/posts/69f20526.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><div class="note blue no-icon flat"><p>在现有的Butterfly主题中（4.12.0），还没有给默认文章封面添加随机的图片的配置，下面是一种解决方法：</p></div><div class="note purple no-icon flat"><p>将默认图片改为随机图片的API网址，让首页发送多次请求，达到首页封面随机的效果。</p></div><h1 id="解决过程"><a href="#解决过程" class="headerlink" title="解决过程"></a>解决过程</h1><div class="note orange no-icon flat"><p>在<code>_config.butterfly.yml</code>文件中找到cover的配置项，<code>default_cover</code>是配置默认封面，把它修改为随机图片的网站。（这种网站百度搜索很多，最好是找有https的站点）</p></div><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="comment"># display the cover or not (是否顯示文章封面)</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># the position of cover in home page (封面顯示的位置)</span></span><br><span class="line">  <span class="comment"># left/right/both</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span></span><br><span class="line">  <span class="attr">suffix:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># When cover is not set, the default cover is displayed (當沒有設置cover時，默認的封面顯示)</span></span><br><span class="line">  <span class="attr">default_cover:</span></span><br><span class="line">    <span class="string">https://api.aixiaowai.cn/api/api.php</span></span><br></pre></td></tr></table></figure><div class="note red no-icon flat"><p>设置之后可以查看首页效果，这个时候会发现，首页封面用的都是同样的图片，这肯定不是最终想要的效果。打开控制台查看发送请求，发现图片请求只发送一次，那图片肯定只有一张，那接下来就是改造一下，让它多发送请求。</p></div><div class="note orange no-icon flat"><p>打开<code>hexo根目录\themes\butterfly\scripts</code>，新建一个<code>random_img.js</code>文件，将以下代码复制进<code>random_img.js</code>文件并保存。</p></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Butterfly</span></span><br><span class="line"><span class="comment"> * ramdom cover</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;before_post_render&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; config &#125; = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">post_asset_folder</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> imgTestReg = <span class="regexp">/\.(png|jpe?g|gif|svg|webp)(\?.*)?$/</span></span><br><span class="line">    <span class="keyword">const</span> topImg = data.<span class="property">top_img</span></span><br><span class="line">    <span class="keyword">const</span> cover = data.<span class="property">cover</span></span><br><span class="line">    <span class="keyword">if</span> (topImg &amp;&amp; topImg.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>) === -<span class="number">1</span> &amp;&amp; imgTestReg.<span class="title function_">test</span>(topImg)) data.<span class="property">top_img</span> = data.<span class="property">path</span> + topImg</span><br><span class="line">    <span class="keyword">if</span> (cover &amp;&amp; cover.<span class="title function_">indexOf</span>(<span class="string">&#x27;/&#x27;</span>) === -<span class="number">1</span>) data.<span class="property">cover</span> = data.<span class="property">path</span> + cover</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">cover</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    data.<span class="property">randomcover</span> = <span class="title function_">randomCover</span>()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  data.<span class="property">cover</span> = data.<span class="property">cover</span> || <span class="title function_">randomCover</span>()</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">randomCover</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> theme = hexo.<span class="property">theme</span>.<span class="property">config</span></span><br><span class="line">  <span class="keyword">let</span> cover</span><br><span class="line">  <span class="keyword">let</span> num</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (theme.<span class="property">cover</span> &amp;&amp; theme.<span class="property">cover</span>.<span class="property">default_cover</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(theme.<span class="property">cover</span>.<span class="property">default_cover</span>)) &#123;</span><br><span class="line">      cover = theme.<span class="property">cover</span>.<span class="property">default_cover</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * theme.<span class="property">cover</span>.<span class="property">default_cover</span>.<span class="property">length</span>)</span><br><span class="line">      cover = theme.<span class="property">cover</span>.<span class="property">default_cover</span>[num]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cover = theme.<span class="property">default_top_img</span> || <span class="string">&#x27;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(theme.<span class="property">cover</span>.<span class="property">suffix</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(theme.<span class="property">cover</span>.<span class="property">suffix</span> == <span class="number">1</span>)</span><br><span class="line">      cover = cover + (<span class="string">&quot;?&quot;</span> + <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">10000</span>))</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(theme.<span class="property">cover</span>.<span class="property">suffix</span> == <span class="number">2</span>)</span><br><span class="line">      cover = cover + (<span class="string">&quot;&amp;&quot;</span> + <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">10000</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cover</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note orange no-icon flat"><p>打开<code>_config.butterfly.yml</code>主题配置文件：在cover:插入<code>suffix: 1</code>并保存（目的是在链接后面加入后缀<code>?spm={随机数}</code> 0是不使用后缀、1是?加随机数；2是&amp;加随机数）</p></div><p><img src="https://img.mstudio.top//img/202407102336923.png"></p><div class="note blue no-icon flat"><p>最后运行就可以了。查看首页，就会发现首页是随机的封面，查看接口，可以看到随机发送了多个请求。</p></div><h1 id="一个小问题"><a href="#一个小问题" class="headerlink" title="一个小问题"></a>一个小问题</h1><div class="note red no-icon flat"><p>在使用一些随机图片<code>api</code>的时候，会发现如果本身的站点是<code>https</code>协议的，而随机图片<code>api</code>不是，会导致手机端无法正常显示，这种情况只能换一个支持<code>https</code>的<code>API</code>了</p></div><p>参考链接：<a href="https://blog.mitsumune.top/2023/02/13/hexo_butterfly%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E5%AF%B9%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87api%E7%9A%84%E6%94%AF%E6%8C%81/">hexo butterfly主题添加对随机图片api的支持</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> butterfly优化 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
